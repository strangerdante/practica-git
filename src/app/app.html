<div class="h-screen w-screen bg-[#0f172a] text-[#f1f5f9] flex flex-col font-sans overflow-hidden">

    <!-- Header -->
    <header class="h-16 border-b border-[#1e293b]/50 flex items-center px-6 justify-between bg-[#020617] z-10 relative">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-[#818cf8] to-[#22d3ee] flex items-center justify-center font-bold text-[#020617] shadow-lg shadow-[#6366f1]/20">
                Gi
            </div>
            <h1
                class="font-bold text-xl tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-[#f1f5f9] to-[#94a3b8] select-none">
                Git Interactive
            </h1>
        </div>

        <div class="flex items-center gap-4 relative" #lessonSelectorContainer>
            <!-- Lesson Selector Button -->
            <button (click)="toggleLessonSelector()"
                class="flex items-center gap-2 text-xs font-mono px-3 py-1.5 rounded-full bg-[#1e293b] border border-[#334155]/50 text-[#f1f5f9] hover:border-[#6366f1] transition-all cursor-pointer">
                <span>{{ currentLesson() ? currentLesson()!.id + '. ' + currentLesson()!.title : 'Seleccionar Lección'
                    }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="opacity-70">
                    <path d="m6 9 6 6 6-6" />
                </svg>
            </button>

            <!-- Dropdown Menu -->
            <div *ngIf="showLessonSelector()"
                class="absolute top-full right-0 mt-2 w-64 bg-[#0f172a] border border-[#1e293b] rounded-lg shadow-2xl overflow-hidden z-50 animate-fade-in origin-top-right">
                <div class="p-2">
                    <div class="text-xs font-semibold text-[#94a3b8] px-2 py-1 uppercase tracking-wider">Lecciones
                        Disponibles</div>
                    <button *ngFor="let lesson of lessons()" (click)="selectLesson(lesson.id)"
                        class="w-full text-left px-3 py-2 rounded text-sm hover:bg-[#1e293b] transition-colors flex items-center gap-2 group"
                        [class.text-[#22d3ee]]="currentLesson()?.id === lesson.id && !isLessonCompleted(lesson)"
                        [class.text-[#4ade80]]="isLessonCompleted(lesson)"
                        [class.bg-[#1e293b]]="currentLesson()?.id === lesson.id"
                        [class.text-[#f1f5f9]]="currentLesson()?.id !== lesson.id && !isLessonCompleted(lesson)">
                        <span class="w-2 h-2 rounded-full"
                            [class.bg-[#6366f1]]="currentLesson()?.id === lesson.id && !isLessonCompleted(lesson)"
                            [class.bg-[#4ade80]]="isLessonCompleted(lesson)"
                            [class.bg-[#94a3b8]]="currentLesson()?.id !== lesson.id && !isLessonCompleted(lesson)"
                            [class.group-hover:bg-[#6366f1]]="currentLesson()?.id !== lesson.id && !isLessonCompleted(lesson)"
                            [class.group-hover:bg-[#4ade80]]="isLessonCompleted(lesson)"></span>
                        {{ lesson.id }}: {{ lesson.title }}
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-hidden p-3 lg:p-6 gap-4 lg:gap-6 flex flex-col lg:grid lg:grid-cols-3">

        <!-- Left Panel: Visualization & Instructions -->
        <section #splitPanel class="lg:col-span-2 flex flex-col flex-[2.5] lg:h-full min-h-0 relative select-none">

            <!-- Visualizer -->
            <div [style.height.%]="visualizerHeight()" [class.pointer-events-none]="isDragging()"
                class="shadow-xl rounded-xl border border-[#1e293b] bg-[#0f172a] overflow-hidden relative min-h-0 transition-none">
                <app-visualizer class="w-full h-full block"></app-visualizer>
            </div>

            <!-- Resizer Handle -->
            <div (mousedown)="startDrag($event)"
                class="h-4 -my-2 z-50 flex items-center justify-center cursor-row-resize hover:bg-[#1e293b]/50 transition-colors group shrink-0">
                <!-- Visual Grip -->
                <div
                    class="w-12 h-1 rounded-full bg-[#1e293b] group-hover:bg-[#6366f1] transition-all duration-300 shadow-sm border border-[#334155]/20 group-hover:border-[#6366f1]/50 group-hover:shadow-[0_0_10px_rgba(99,102,241,0.3)]">
                </div>
            </div>

            <!-- Terminal -->
            <div
                class="flex-1 shadow-2xl rounded-xl overflow-hidden border border-[#1e293b] flex flex-col bg-[#0f172a] min-h-0 transition-none">
                <app-terminal class="h-full w-full block"></app-terminal>
            </div>
        </section>

        <!-- Right Panel: Lesson Instructions -->
        <section class="lg:col-span-1 flex-1 lg:h-full min-h-0">
            <div class="h-full bg-[#0f172a]/50 border border-[#1e293b] rounded-xl p-6 overflow-y-auto shadow-lg">
                <div *ngIf="currentLesson() as lesson">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-lg font-semibold text-[#f1f5f9] flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full" [class.bg-[#6366f1]]="!isLessonCompleted(lesson)"
                                    [class.bg-[#4ade80]]="isLessonCompleted(lesson)"
                                    [class.animate-pulse]="!isLessonCompleted(lesson)"></span>
                                {{ lesson.id }}: {{ lesson.title }}
                                <button (click)="resetLesson(lesson.id)"
                                    class="ml-3 p-1.5 rounded-md bg-[#ef4444]/10 text-[#f87171] border border-[#ef4444]/20 hover:bg-[#ef4444] hover:text-white hover:shadow-[0_0_10px_rgba(239,68,68,0.5)] transition-all"
                                    title="Reiniciar Lección">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                        <path d="M3 3v5h5" />
                                    </svg>
                                </button>
                            </h2>
                            <p class="text-[#94a3b8] text-sm mt-1">{{ lesson.description }}</p>
                        </div>

                    </div>

                    <!-- Practices Selector -->
                    <div *ngIf="lesson.practices && lesson.practices.length > 0" class="flex flex-wrap gap-2 mb-6">
                        <button *ngFor="let p of lesson.practices" (click)="selectPractice(p.id)"
                            class="px-3 py-1.5 rounded-lg text-xs font-semibold border transition-all flex flex-col items-start gap-1"
                            [ngClass]="getPracticeButtonClass(lesson.id, p)">
                            <span>Práctica {{ p.id }}</span>
                            <!-- <span class="text-[10px] opacity-70 font-normal">{{ p.title }}</span> -->
                        </button>
                    </div>

                    <div *ngIf="currentPractice() as practice"
                        class="mb-4 p-3 bg-[#6366f1]/10 rounded border border-[#6366f1]/20">
                        <h3 class="text-[#a5b4fc] font-bold text-sm">{{ practice.title }}</h3>
                        <p class="text-xs text-[#94a3b8] mt-1">{{ practice.description }}</p>
                    </div>

                    <div class="grid grid-cols-1 gap-4"> <!-- Changed grid-cols to 1 stack for sidebar -->
                        <div class="bg-[#0f172a] rounded-lg p-4 border border-[#1e293b]/50">
                            <h3
                                class="text-[#fbbf24] text-sm font-bold uppercase tracking-wider mb-3 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z">
                                    </path>
                                </svg>
                                Misión Actual
                                <button *ngIf="currentPractice()"
                                    (click)="resetPractice(lesson.id, currentPractice()?.id)"
                                    class="ml-auto p-1.5 rounded-md bg-[#ef4444]/10 text-[#f87171] border border-[#ef4444]/20 hover:bg-[#ef4444] hover:text-white hover:shadow-[0_0_10px_rgba(239,68,68,0.5)] transition-all"
                                    title="Reiniciar Práctica">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                        <path d="M3 3v5h5" />
                                    </svg>
                                </button>
                            </h3>
                            <ul class="text-sm text-[#f1f5f9]/90 space-y-2">
                                <li *ngFor="let step of (currentPractice()?.steps || lesson.steps)"
                                    class="flex items-start gap-3 group cursor-pointer hover:bg-[#1e293b]/30 p-1.5 -mx-1.5 rounded transition-colors"
                                    (click)="toggleStep(lesson.id, step.id)">

                                    <!-- Checkbox -->
                                    <div class="mt-0.5 shrink-0 w-5 h-5 rounded border border-[#334155] flex items-center justify-center transition-all duration-200"
                                        [class.bg-[#4ade80]]="completedSteps()[lesson.id]?.includes(step.id)"
                                        [class.border-[#4ade80]]="completedSteps()[lesson.id]?.includes(step.id)"
                                        [class.group-hover:border-[#22d3ee]]="!completedSteps()[lesson.id]?.includes(step.id)">
                                        <svg *ngIf="completedSteps()[lesson.id]?.includes(step.id)"
                                            xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                                            viewBox="0 0 24 24" fill="none" stroke="#0f172a" stroke-width="3"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                    </div>

                                    <div class="flex-1 transition-opacity duration-200"
                                        [class.opacity-50]="completedSteps()[lesson.id]?.includes(step.id)">
                                        <span class="text-[#f1f5f9] text-sm">{{ step.text }}</span>
                                        <code *ngIf="step.command"
                                            class="bg-[#0f172a] px-1.5 py-0.5 rounded text-[#fbbf24] font-mono text-xs border border-[#1e293b] block mt-1 w-fit group-hover:border-[#334155] transition-colors">
                                            {{ step.command }}
                                        </code>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-[#1e293b]/30 rounded-lg p-4 border border-[#1e293b]/30">
                            <h3
                                class="text-[#22d3ee] text-sm font-bold uppercase tracking-wider mb-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                Tips
                            </h3>
                            <ul class="text-xs text-[#94a3b8] leading-relaxed space-y-2">
                                <li *ngFor="let tip of (currentPractice()?.tips || lesson.tips)" class="flex gap-2">
                                    <span [ngClass]="{
                                        'text-[#22d3ee]': tip.type === 'info',
                                        'text-[#6366f1]': tip.type === 'pro',
                                        'text-[#facc15]': tip.type === 'warning'
                                    }">•</span>
                                    <span>{{ tip.text }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
</div>